<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>AgriWave ‚Äì Gesti√≥n Ganadera</title>
  <meta name="description" content="App web para gestionar animales, finanzas, lotes, salud y reportes con soporte offline."/>
  <link rel="manifest" href="manifest.json">
  <link rel="icon" href="icons/icon-192.png">
  <link rel="stylesheet" href="styles.css" />
  <script defer src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script type="module" src="app.js"></script>
</head>
<body>
  <header class="topbar">
    <h1>AgriWave</h1>
    <div class="status">
      <span id="onlineStatus" class="badge">‚óè</span>
      <span id="syncStatus">Offline</span>
    </div>
  </header>

  <nav class="tabs" role="tablist" aria-label="Secciones">
    <button class="tab active" data-tab="animales">Animales</button>
    <button class="tab" data-tab="finanzas">Finanzas</button>
    <button class="tab" data-tab="lotes">Lotes</button>
    <button class="tab" data-tab="salud">Sanidad</button>
    <button class="tab" data-tab="reportes">Reportes</button>
    <button class="tab" data-tab="sync">Sincronizar</button>
  </nav>

  <main>
    <!-- Animales -->
    <section id="animales" class="panel active">
      <h2>Registro y Historial de Animales</h2>
      <form id="animalForm" class="card">
        <div class="grid">
          <label>
            ID Individual
            <input required name="id" placeholder="A-0001">
          </label>
          <label>
            Raza
            <input name="raza" placeholder="Brahman">
          </label>
          <label>
            Sexo
            <select name="sexo">
              <option>Macho</option>
              <option>Hembra</option>
            </select>
          </label>
          <label>
            Fecha de Nacimiento
            <input type="date" name="fechaNacimiento">
          </label>
          <label class="colspan">
            Observaciones
            <textarea name="observaciones" rows="2" placeholder="Notas generales"></textarea>
          </label>
        </div>
        <div class="actions">
          <button type="submit">Guardar/Actualizar</button>
          <button type="button" id="animalReset">Limpiar</button>
        </div>
      </form>

      <div class="card">
        <div class="toolbar">
          <input id="animalSearch" placeholder="Buscar por ID o Raza">
          <button id="exportAnimales">Exportar JSON</button>
          <label class="import">
            Importar JSON
            <input type="file" id="importAnimales" accept="application/json">
          </label>
        </div>
        <table id="animalTable">
          <thead><tr><th>ID</th><th>Raza</th><th>Sexo</th><th>Nacimiento</th><th>Acciones</th></tr></thead>
          <tbody></tbody>
        </table>
      </div>

      <div class="card">
        <h3>Historial del Animal seleccionado</h3>
        <p class="muted">Se llena autom√°ticamente al seleccionar un animal üå±</p>
        <ul id="animalHistory"></ul>
      </div>
    </section>

    <!-- Finanzas -->
    <section id="finanzas" class="panel">
      <h2>Ingresos/Egresos y Balance</h2>
      <form id="finForm" class="card">
        <div class="grid">
          <label>
            Fecha
            <input type="date" name="fecha" required>
          </label>
          <label>
            Tipo
            <select name="tipo">
              <option value="ingreso">Ingreso</option>
              <option value="egreso">Egreso</option>
            </select>
          </label>
          <label>
            Monto
            <input type="number" step="0.01" name="monto" required placeholder="0.00">
          </label>
          <label class="colspan">
            Concepto
            <input name="concepto" placeholder="Venta de terneros / Alimento / etc.">
          </label>
        </div>
        <div class="actions">
          <button type="submit">Registrar</button>
          <button type="button" id="finReset">Limpiar</button>
        </div>
      </form>

      <div class="card">
        <div class="toolbar">
          <input id="finSearch" placeholder="Filtrar por concepto">
          <button id="exportFin">Exportar JSON</button>
          <label class="import">
            Importar JSON
            <input type="file" id="importFin" accept="application/json">
          </label>
        </div>
        <table id="finTable">
          <thead><tr><th>Fecha</th><th>Tipo</th><th>Concepto</th><th>Monto</th><th></th></tr></thead>
          <tbody></tbody>
          <tfoot>
            <tr><td colspan="3"><b>Balance</b></td><td id="balanceCell">0</td><td></td></tr>
          </tfoot>
        </table>
      </div>
    </section>

    <!-- Lotes -->
    <section id="lotes" class="panel">
      <h2>Uso de Lotes y Potreros</h2>
      <form id="loteForm" class="card">
        <div class="grid">
          <label>
            Lote/Potrero
            <input name="lote" required placeholder="Potrero 1">
          </label>
          <label>
            Animal (ID)
            <input name="animalId" placeholder="A-0001">
          </label>
          <label>
            Fecha de Entrada
            <input type="date" name="entrada">
          </label>
          <label>
            Fecha de Salida
            <input type="date" name="salida">
          </label>
          <label class="colspan">
            Nota
            <input name="nota" placeholder="Rotaci√≥n, pastura, etc.">
          </label>
        </div>
        <div class="actions">
          <button type="submit">Registrar Uso</button>
          <button type="button" id="loteReset">Limpiar</button>
        </div>
      </form>

      <div class="card">
        <div class="toolbar">
          <input id="loteSearch" placeholder="Filtrar por lote o animal">
          <button id="exportLotes">Exportar JSON</button>
          <label class="import">
            Importar JSON
            <input type="file" id="importLotes" accept="application/json">
          </label>
        </div>
        <table id="loteTable">
          <thead><tr><th>Lote</th><th>Animal</th><th>Entrada</th><th>Salida</th><th>Nota</th><th></th></tr></thead>
          <tbody></tbody>
        </table>
      </div>
    </section>

    <!-- Sanidad -->
    <section id="salud" class="panel">
      <h2>Historial Sanitario, Vacunas y Tratamientos</h2>
      <form id="saludForm" class="card">
        <div class="grid">
          <label>
            Animal (ID)
            <input name="animalId" required placeholder="A-0001">
          </label>
          <label>
            Fecha
            <input type="date" name="fecha" required>
          </label>
          <label>
            Tipo
            <select name="tipo">
              <option>Vacuna</option>
              <option>Tratamiento</option>
              <option>Revisi√≥n</option>
            </select>
          </label>
          <label class="colspan">
            Descripci√≥n
            <input name="descripcion" placeholder="Vacuna aftosa / Desparasitaci√≥n / etc.">
          </label>
        </div>
        <div class="actions">
          <button type="submit">Guardar</button>
          <button type="button" id="saludReset">Limpiar</button>
        </div>
      </form>

      <div class="card">
        <div class="toolbar">
          <input id="saludSearch" placeholder="Filtrar por animal o tipo">
          <button id="exportSalud">Exportar JSON</button>
          <label class="import">
            Importar JSON
            <input type="file" id="importSalud" accept="application/json">
          </label>
        </div>
        <table id="saludTable">
          <thead><tr><th>Fecha</th><th>Animal</th><th>Tipo</th><th>Descripci√≥n</th><th></th></tr></thead>
          <tbody></tbody>
        </table>
      </div>
    </section>

    <!-- Reportes -->
    <section id="reportes" class="panel">
      <h2>Reportes y An√°lisis Integrado</h2>
      <div class="card grid-2">
        <div>
          <h3>Resumen</h3>
          <ul id="resumenList" class="summary"></ul>
        </div>
        <div>
          <h3>Gr√°fico Ingresos vs Egresos</h3>
          <canvas id="chartFin"></canvas>
        </div>
      </div>

      <div class="card grid-2">
        <div>
          <h3>Vacunas y Tratamientos por Animal</h3>
          <canvas id="chartSalud"></canvas>
        </div>
        <div>
          <h3>Uso de Lotes por Animal</h3>
          <canvas id="chartLotes"></canvas>
        </div>
      </div>

      <div class="card">
        <button id="exportTodo">Exportar TODO (copia de seguridad)</button>
        <label class="import">
          Restaurar TODO
          <input type="file" id="importTodo" accept="application/json">
        </label>
      </div>
    </section>

    <!-- Sync -->
    <section id="sync" class="panel">
      <h2>Sincronizaci√≥n</h2>
      <div class="card">
        <p>La app funciona <b>offline</b> (IndexedDB + Service Worker).</p>
        <p>Puedes sincronizar con tu servidor exportando/importando el respaldo JSON,
        o implementa tu endpoint y configura la URL abajo.</p>
        <label>
          Endpoint de sincronizaci√≥n (POST JSON):
          <input id="syncUrl" placeholder="https://tu-servidor/api/sync">
        </label>
        <div class="actions">
          <button id="btnSyncUpload">Subir datos</button>
          <button id="btnSyncDownload">Sobrescribir con datos del servidor</button>
        </div>
        <pre id="syncLog" class="log"></pre>
      </div>
    </section>
  </main>

  <footer class="footer">
    <small>¬© 2025 AgriWave ‚Ä¢ PWA Offline ‚Ä¢ Hecho para tu proyecto</small>
  </footer>

  <script>
    // Registrar service worker
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
        navigator.serviceWorker.register('sw.js');
      });
    }
  </script>
</body>
</html>
